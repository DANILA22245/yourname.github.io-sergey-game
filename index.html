<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>–°–µ—Ä–µ–≥–∞ –ë–µ–∂–∏—Ç</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #000;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      height: 100vh;
      touch-action: manipulation;
    }
    #menu {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      gap: 20px;
      position: relative;
      background: #000;
    }
    #menuVideo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }
    #menu button {
      padding: 16px 32px;
      font-size: 20px;
      border: none;
      border-radius: 12px;
      background: rgba(233, 30, 99, 0.85);
      color: white;
      cursor: pointer;
      backdrop-filter: blur(4px);
      z-index: 10;
    }
    #game {
      display: none;
      position: relative;
      width: 100vw;
      height: 100vh;
      background: #000;
    }
    #startVid {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      z-index: 10;
    }
    #gameplayArea {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: url('assets/512c5d04-68e6-4539-a13f-052ae0d9a9cd.jpg') center/cover no-repeat;
      z-index: 1;
    }
    #score {
      position: absolute;
      top: 20px;
      left: 20px;
      z-index: 10;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 6px #000;
    }
    .item {
      position: absolute;
      width: 60px;
      height: 60px;
      z-index: 2;
      pointer-events: none;
    }
    .item.obstacle {
      filter: drop-shadow(0 0 5px #ff4444);
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Game Over */
    #gameOverModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }
    .modal-content {
      background: #222;
      padding: 30px;
      border-radius: 16px;
      text-align: center;
      max-width: 320px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }
    .modal-content h2 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #fff;
    }
    .modal-content button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #e91e63;
      color: white;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent; /* —É–±–∏—Ä–∞–µ—Ç —Å–µ—Ä—ã–π –æ—Ç–∫–ª–∏–∫ –Ω–∞ iOS */
    }
  </style>
</head>
<body>

  <!-- –ú–ï–ù–Æ -->
<div id="menu">
  <img id="menuImage" src="assets/342423234.jpg" alt="–ú–µ–Ω—é">
  <button id="startBtn">–ü–æ–≥–Ω–∞–ª–∏ –Ω–∞—Ö—É–π</button>
</div>

  <!-- –ò–ì–†–ê -->
  <div id="game">
    <video id="startVid" muted playsinline webkit-playsinline disableRemotePlayback>
      <source src="assets/video5435982412527994375.mp4" type="video/mp4">
    </video>

    <div id="gameplayArea">
      <div id="score">üçî: <span id="count">0</span></div>
      <div id="gameArea"></div>
    </div>
  </div>

  <!-- –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
  <div id="gameOverModal">
    <div class="modal-content">
      <h2 id="gameOverMessage">–ü–æ—à–ª–∞ –Ω–∞—Ö—É–π</h2>
      <button id="gameOverBtn">–¢–∏–Ω–¥–µ—Ä —É—à—ë–ª –∏–∑ –†–æ—Å—Å–∏–∏</button>
    </div>
  </div>

  <script>
    // Telegram WebApp ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();
    }

    function supportsWebM() {
      const video = document.createElement('video');
      return video.canPlayType('video/webm; codecs="vp8, vorbis"') !== '';
    }

    const LANES = 3;
    let currentLane = 1;
    let score = 0;
    let gameActive = false;
    let gameStarted = false;
    let items = [];
    let playerVideo = null;

    const menu = document.getElementById('menu');
    const menuVideo = document.getElementById('menuVideo');
    const game = document.getElementById('game');
    const startVid = document.getElementById('startVid');
    const gameplayArea = document.getElementById('gameplayArea');
    const scoreEl = document.getElementById('count');
    const gameArea = document.getElementById('gameArea');
    const startBtn = document.getElementById('startBtn');
    const gameOverModal = document.getElementById('gameOverModal');
    const gameOverBtn = document.getElementById('gameOverBtn');

    scoreEl.textContent = score;

    function getLaneX(lane) {
      const w = window.innerWidth;
      return [w * 0.2, w * 0.5, w * 0.8][lane];
    }

    function updatePlayerPosition() {
      if (!playerVideo) return;
      const x = getLaneX(currentLane);
      playerVideo.style.left = x + 'px';
      playerVideo.style.transform = 'translateX(-50%)';
    }

    function createPlayerVideo() {
      const video = document.createElement('video');
      video.muted = true;
      video.playsInline = true;
      video.setAttribute('playsinline', '');
      video.setAttribute('webkit-playsinline', '');
      video.setAttribute('disableRemotePlayback', '');
      video.preload = 'auto';
      video.style.position = 'absolute';
      video.style.bottom = '40px';
      video.style.left = '50%';
      video.style.transform = 'translateX(-50%)';
      video.style.width = '120px';
      video.style.height = 'auto';
      video.style.zIndex = '5';
      video.style.pointerEvents = 'none';
      video.style.mixBlendMode = 'multiply';

      const src = supportsWebM()
        ? 'assets/ed78c27cdbc94f7ca120261cea495577.webm'
        : 'assets/ed78c27cdbc94f7ca120261cea495577.mp4';

      video.src = src;
      return video;
    }

    function startPlayerLoop() {
      if (playerVideo) playerVideo.remove();
      playerVideo = createPlayerVideo();
      gameplayArea.appendChild(playerVideo);
      playerVideo.play().catch(e => console.warn("Player video play failed:", e));
      playerVideo.addEventListener('ended', () => {
        if (gameActive) startPlayerLoop();
      });
      updatePlayerPosition();
    }

    function startGameplay() {
      gameplayArea.style.display = 'block';
      gameActive = true;
      startPlayerLoop();
      gameLoop();
    }

    function startGame() {
      if (gameStarted) return;
      gameStarted = true;

      menu.style.display = 'none';
      game.style.display = 'block';
      gameActive = false;

      startVid.style.display = 'block';
      startVid.currentTime = 0;
      startVid.play().catch(err => {
        console.error("Start video play failed:", err);
        setTimeout(() => {
          startVid.style.display = 'none';
          startGameplay();
        }, 300);
      });

      startVid.addEventListener('ended', () => {
        startVid.style.display = 'none';
        startGameplay();
      }, { once: true });
    }

    startBtn.addEventListener('click', startGame);

    function gameLoop() {
      if (!gameActive) return;
      if (Math.random() < 0.03) spawnItem('burger');
      if (Math.random() < 0.005) spawnItem('obstacle');
      if (Math.random() < 0.002) spawnItem('toxicGirl');
      moveItems();
      checkCollisions();
      requestAnimationFrame(gameLoop);
    }

    function spawnItem(type) {
      const lane = Math.floor(Math.random() * LANES);
      const el = document.createElement('img');
      el.className = 'item';
      el.dataset.lane = lane;
      el.dataset.type = type;

      if (type === 'burger') {
        el.src = 'assets/zFY1nVjmRgzJSjctAKqE2g-fotor-bg-remover-20251014121040.png';
        el.style.left = getLaneX(lane) - 30 + 'px';
        el.style.top = '-60px';
        items.push({ el, lane, top: -60, type });
      } else if (type === 'obstacle') {
        el.src = 'assets/myach.png';
        el.style.left = getLaneX(lane) - 30 + 'px';
        el.style.top = '-60px';
        el.classList.add('obstacle');
        items.push({ el, lane, top: -60, type });
      } else if (type === 'toxicGirl') {
        el.src = 'assets/17-fotor-bg-remover-20251016132236.png';
        el.style.left = getLaneX(lane) - 30 + 'px';
        el.style.top = '-60px';
        el.classList.add('obstacle');
        items.push({ el, lane, top: -60, type });
      }

      gameArea.appendChild(el);
    }

    function moveItems() {
      for (let i = items.length - 1; i >= 0; i--) {
        const item = items[i];
        item.top += 5;
        item.el.style.top = item.top + 'px';
        if (item.top > window.innerHeight) {
          item.el.remove();
          items.splice(i, 1);
        }
      }
    }

    function checkCollisions() {
      for (let i = items.length - 1; i >= 0; i--) {
        const item = items[i];
        const inPlayerZone = item.top > window.innerHeight * 0.7 && item.top < window.innerHeight * 0.95;
        const sameLane = item.lane === currentLane;

        if (inPlayerZone && sameLane) {
          if (item.type === 'burger') {
            score++;
            scoreEl.textContent = score;
            item.el.remove();
            items.splice(i, 1);
          } else if (item.type === 'obstacle') {
            showGameOver("–°–µ—Ä–µ–≥–∞ —É–¥–∞—Ä–∏–ª –ø–æ –º—è—á—É –∏ —Ä–∞–∑—ä–µ–±–∞–ª –Ω–æ–≥–æ—Ç—å üò≠", "–°–ø–æ—Ä—Ç —Ö—É–π–Ω—è");
            return;
          } else if (item.type === 'toxicGirl') {
            showGameOver("–¢–∏–Ω–¥–µ—Ä —É—à—ë–ª –∏–∑ –†–æ—Å—Å–∏–∏", "–ü–æ—à–ª–∞ –Ω–∞—Ö—É–π");
            return;
          }
        }
      }
    }

    function showGameOver(message, buttonText) {
      document.getElementById('gameOverMessage').textContent = message;
      gameOverBtn.textContent = buttonText;
      gameOverModal.style.display = 'flex';
    }

    // ‚úÖ –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –î–õ–Ø –ú–û–ë–ò–õ–ö–ò –ò –î–ï–°–ö–¢–û–ü–ê
    function handleRestart() {
      // –û—á–∏—Å—Ç–∫–∞ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
      items.forEach(item => item.el.remove());
      items = [];
      if (playerVideo) {
        playerVideo.remove();
        playerVideo = null;
      }

      // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
      gameOverModal.style.display = 'none';
      gameActive = false;
      gameStarted = false;
      gameplayArea.style.display = 'none';
      score = 0;
      scoreEl.textContent = score;

      // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ ‚Äî –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è!
      startVid.style.display = 'block';
      startVid.currentTime = 0;
      startVid.play().catch(err => {
        console.error("Restart video play failed:", err);
        setTimeout(() => {
          startVid.style.display = 'none';
          gameplayArea.style.display = 'block';
          gameActive = true;
          startPlayerLoop();
          gameLoop();
        }, 300);
      });

      startVid.addEventListener('ended', () => {
        startVid.style.display = 'none';
        gameplayArea.style.display = 'block';
        gameActive = true;
        startPlayerLoop();
        gameLoop();
      }, { once: true });
    }

    // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∫–ª–∏–∫–∞, –∏ —Ç–∞—á–∞
    gameOverBtn.addEventListener('click', handleRestart);
    gameOverBtn.addEventListener('touchend', handleRestart);

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    if (isTouchDevice) {
      window.addEventListener('touchstart', (e) => {
        if (!gameActive) return;
        const touchStartX = e.touches[0].clientX;
        const handleTouchEnd = (ev) => {
          const diff = ev.changedTouches[0].clientX - touchStartX;
          if (Math.abs(diff) > 60) {
            if (diff > 0 && currentLane < 2) {
              currentLane++;
              updatePlayerPosition();
            } else if (diff < 0 && currentLane > 0) {
              currentLane--;
              updatePlayerPosition();
            }
          }
          window.removeEventListener('touchend', handleTouchEnd, { passive: false });
          ev.preventDefault();
        };
        window.addEventListener('touchend', handleTouchEnd, { passive: false });
        e.preventDefault();
      }, { passive: false });
    } else {
      window.addEventListener('click', (e) => {
        if (!gameActive) return;
        const half = window.innerWidth / 2;
        if (e.clientX < half && currentLane > 0) {
          currentLane--;
          updatePlayerPosition();
        } else if (e.clientX > half && currentLane < 2) {
          currentLane++;
          updatePlayerPosition();
        }
      });
    }
  </script>
</body>
</html>







